#!/usr/bin/env bash

# DEPENDENCIES
# -------------------------------------------------------------------------------------------------
# - bash 4

# Global variables
# -------------------------------------------------------------------------------------------------
FILE_PATH=$(realpath "${0}")
BIN_DIR="${BIN_DIR:-$(dirname $FILE_PATH)}"
PARENT_BIN_DIR="${PARENT_BIN_DIR:-$(dirname $BIN_DIR)}"

# Entrypoint
# -------------------------------------------------------------------------------------------------

function main {
  validate_requirements
  install_fresh
}

# Validate requirements
# -------------------------------------------------------------------------------------------------

function validate_requirements {
  validate_bash_dependency
}

function validate_bash_dependency {
  major_version="$(bash --version | head -1 | cut -d ' ' -f 4 | cut -d '.' -f 1)"
  min_major_version="4"

  if [ "${major_version}" -lt "${min_major_version}" ]; then
    throw_error "Your bash major version must be ${min_major_version} or greater"
  fi
}

# Install fresh
# -------------------------------------------------------------------------------------------------

function install_fresh {
  install_from_remote
  link_synced_freshrc
}

function install_from_remote {
  bash -c "curl -sL https://get.freshshell.com"
}

function link_synced_freshrc {
  rm -f "${HOME}/.freshrc" || true
  ln -s "${PARENT_BIN_DIR}/freshrc" "${HOME}/.freshrc"
}

# Execute
# -------------------------------------------------------------------------------------------------

main
